<div class="grid-col grid-col-3 grid-offset-2">
  {% include search.html size="small" %}
  <nav class="margin-y-4 sidenav">
    <ul class="usa-accordion usa-sidenav">
      {% for subpage in site.help_pages %}
      <li class="usa-sidenav__item__empty">
        {% assign subpage_slug = subpage | slugify %}
        {% assign related_questions = site.help | where_exp: "item", "item.url contains subpage_slug" | sort: 'order' %}
        {% capture is_initially_expanded %}
        {% if page.url contains subpage_slug %}true{% else %}false
        {% endif %}
        {% endcapture %}
        {% capture is_initially_hidden %}
        {% if page.url contains subpage_slug %}false{% else %}true
        {% endif %}
        {% endcapture %}
      <li class="usa-sidenav__item usa-parent {% if page.url contains subpage_slug %}usa-current{% else %} {% endif %}"
        aria-expanded="{{ is_initially_expanded }}">
        {{ site["translations"][site.lang]["help_subpages"][subpage] }}
      </li>

      <div aria-hidden={{ is_initially_hidden }}>
        <ul class="usa-sidenav__sublist">
          {% for question in related_questions %}
          {% if question.url == page.url %}
          {% assign _index = forloop.index | modulo:7 %}
          {% endif %}
          <li class="usa-sidenav__item">
            {% assign url_size = question.url | size | minus: 1 %}
            {% assign page_title = question.url | replace: "/", "." | slice: 1, url_size %}
            {% capture page_title %}
            {% t page_title %}
            {% endcapture %}
            <a class="{% if question.url == page.url %} active {% endif %}"
              href="{{ question.url | prepend: site.baseurl }}">{{ page_title }}</a>
          </li>
          {% endfor %}
        </ul>
      </div>
      </li>
      {% endfor %}
    </ul>
  </nav>
</div>
